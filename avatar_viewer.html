<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Avatar Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-width: 250px;
        }
        
        .spec-item {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .spec-label {
            font-weight: bold;
            color: #667eea;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-align: center;
        }
        
        #error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h3 style="margin-top: 0; color: #667eea;">Your 3D Avatar</h3>
        <div class="spec-item">
            <span class="spec-label">Gender:</span> <span id="gender">male</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Body Type:</span> <span id="bodyType">athletic</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Skin Tone:</span> <span id="skinTone">medium</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Style:</span> <span id="style">casual</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Hair Color:</span> <span id="hairColor">brown</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Eye Color:</span> <span id="eyeColor">brown</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Has Beard:</span> <span id="hasBeard">No</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Has Glasses:</span> <span id="hasGlasses">No</span>
        </div>
    </div>
    
    <div id="loading">
        <div>üé® Creating your 3D avatar...</div>
        <div style="margin-top: 10px; font-size: 14px; opacity: 0.8;">
            Drag to rotate ‚Ä¢ Scroll to zoom
        </div>
    </div>

    <div id="error" style="display: none;">
        <div>‚ö†Ô∏è Error loading 3D avatar</div>
        <div style="margin-top: 10px; font-size: 14px;">
            Please check your browser console for details
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        
        // Update avatar specifications from URL parameters
        function updateSpecs() {
            const gender = urlParams.get('gender') || 'male';
            const bodyType = urlParams.get('bodyType') || 'athletic';
            const skinTone = urlParams.get('skinTone') || 'medium';
            const style = urlParams.get('style') || 'casual';
            const hairColor = urlParams.get('hairColor') || 'brown';
            const eyeColor = urlParams.get('eyeColor') || 'brown';
            const hasBeard = urlParams.get('hasBeard') === 'true';
            const hasGlasses = urlParams.get('hasGlasses') === 'true';
            
            document.getElementById('gender').textContent = gender;
            document.getElementById('bodyType').textContent = bodyType;
            document.getElementById('skinTone').textContent = skinTone;
            document.getElementById('style').textContent = style;
            document.getElementById('hairColor').textContent = hairColor;
            document.getElementById('eyeColor').textContent = eyeColor;
            document.getElementById('hasBeard').textContent = hasBeard ? 'Yes' : 'No';
            document.getElementById('hasGlasses').textContent = hasGlasses ? 'Yes' : 'No';
            
            return { gender, bodyType, skinTone, style, hairColor, eyeColor, hasBeard, hasGlasses };
        }
        
        // Wait for Three.js to load
        setTimeout(() => {
            try {
                initThreeJS();
            } catch (error) {
                console.error('Error initializing Three.js:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }, 1000);
        
        function initThreeJS() {
            // Hide loading
            document.getElementById('loading').style.display = 'none';
            
            // Get avatar specifications
            const specs = updateSpecs();
            
            // Scene setup
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xeceff1);
            
            const camera = new THREE.PerspectiveCamera(
                75, 
                window.innerWidth / window.innerHeight, 
                0.1, 
                1000
            );
            camera.position.set(0, 1.6, 5);
            
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            
            // Lights
            const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
            hemi.position.set(0, 2, 0);
            scene.add(hemi);
            
            const dir = new THREE.DirectionalLight(0xffffff, 0.8);
            dir.position.set(3, 10, 4);
            dir.castShadow = true;
            dir.shadow.mapSize.width = 2048;
            dir.shadow.mapSize.height = 2048;
            scene.add(dir);
            
            // Create avatar
            const avatar = createAvatar(specs);
            scene.add(avatar);
            
            // Controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 1.2, 0);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.update();
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
            
            // Handle resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        function createAvatar(specs) {
            const avatar = new THREE.Group();
            
            // Colors based on specifications
            const skinColor = getSkinColor(specs.skinTone);
            const clothingColor = getClothingColor(specs.style);
            const hairColorHex = getHairColor(specs.hairColor);
            const eyeColorHex = getEyeColor(specs.eyeColor);
            
            // Materials
            const skinMat = new THREE.MeshStandardMaterial({ color: skinColor });
            const clothMat = new THREE.MeshStandardMaterial({ color: clothingColor });
            const hairMat = new THREE.MeshStandardMaterial({ color: hairColorHex });
            const eyeMat = new THREE.MeshStandardMaterial({ color: eyeColorHex });
            
            // Head
            const headGeometry = new THREE.BoxGeometry(0.6, 0.6, 0.6);
            const head = new THREE.Mesh(headGeometry, skinMat);
            head.position.y = 2.2;
            head.castShadow = true;
            avatar.add(head);
            
            // Eyes
            const eyeGeometry = new THREE.SphereGeometry(0.08, 8, 8);
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMat);
            leftEye.position.set(-0.15, 2.3, 0.25);
            avatar.add(leftEye);
            
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMat);
            rightEye.position.set(0.15, 2.3, 0.25);
            avatar.add(rightEye);
            
            // Hair
            const hairGeometry = new THREE.BoxGeometry(0.7, 0.3, 0.7);
            const hair = new THREE.Mesh(hairGeometry, hairMat);
            hair.position.y = 2.5;
            avatar.add(hair);
            
            // Beard (if applicable)
            if (specs.hasBeard && specs.gender === 'male') {
                const beardGeometry = new THREE.BoxGeometry(0.4, 0.2, 0.1);
                const beard = new THREE.Mesh(beardGeometry, hairMat);
                beard.position.set(0, 1.9, 0.25);
                avatar.add(beard);
            }
            
            // Glasses (if applicable)
            if (specs.hasGlasses) {
                const glassesGeometry = new THREE.BoxGeometry(0.4, 0.1, 0.05);
                const glasses = new THREE.Mesh(glassesGeometry, new THREE.MeshStandardMaterial({ color: 0x333333 }));
                glasses.position.set(0, 2.3, 0.3);
                avatar.add(glasses);
            }
            
            // Torso
            const torsoGeometry = new THREE.BoxGeometry(1, 1.2, 0.5);
            const torso = new THREE.Mesh(torsoGeometry, clothMat);
            torso.position.y = 1.2;
            torso.castShadow = true;
            avatar.add(torso);
            
            // Arms
            const armGeometry = new THREE.BoxGeometry(0.3, 1, 0.3);
            const leftArm = new THREE.Mesh(armGeometry, clothMat);
            leftArm.position.set(-0.65, 1.2, 0);
            leftArm.castShadow = true;
            avatar.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, clothMat);
            rightArm.position.set(0.65, 1.2, 0);
            rightArm.castShadow = true;
            avatar.add(rightArm);
            
            // Hands
            const handGeometry = new THREE.SphereGeometry(0.15, 8, 8);
            const leftHand = new THREE.Mesh(handGeometry, skinMat);
            leftHand.position.set(-0.65, 0.5, 0);
            leftHand.castShadow = true;
            avatar.add(leftHand);
            
            const rightHand = new THREE.Mesh(handGeometry, skinMat);
            rightHand.position.set(0.65, 0.5, 0);
            rightHand.castShadow = true;
            avatar.add(rightHand);
            
            // Legs
            const legGeometry = new THREE.BoxGeometry(0.4, 1.2, 0.4);
            const leftLeg = new THREE.Mesh(legGeometry, new THREE.MeshStandardMaterial({ color: 0x333333 }));
            leftLeg.position.set(-0.25, 0, 0);
            leftLeg.castShadow = true;
            avatar.add(leftLeg);
            
            const rightLeg = new THREE.Mesh(legGeometry, new THREE.MeshStandardMaterial({ color: 0x333333 }));
            rightLeg.position.set(0.25, 0, 0);
            rightLeg.castShadow = true;
            avatar.add(rightLeg);
            
            // Feet
            const footGeometry = new THREE.BoxGeometry(0.3, 0.2, 0.6);
            const leftFoot = new THREE.Mesh(footGeometry, new THREE.MeshStandardMaterial({ color: 0x000000 }));
            leftFoot.position.set(-0.25, -0.7, 0.1);
            leftFoot.castShadow = true;
            avatar.add(leftFoot);
            
            const rightFoot = new THREE.Mesh(footGeometry, new THREE.MeshStandardMaterial({ color: 0x000000 }));
            rightFoot.position.set(0.25, -0.7, 0.1);
            rightFoot.castShadow = true;
            avatar.add(rightFoot);
            
            return avatar;
        }
        
        function getSkinColor(tone) {
            const colors = {
                'light': 0xffdbd3c3,
                'medium': 0xffd1b5,
                'olive': 0xffc19a6b,
                'tan': 0xffb8956b,
                'dark': 0xff8d5524
            };
            return colors[tone] || colors['medium'];
        }
        
        function getClothingColor(style) {
            const colors = {
                'casual': 0x2b6cb0,
                'professional': 0x2d3748,
                'artistic': 0x9f7aea,
                'elegant': 0x4a5568,
                'sporty': 0xe53e3e
            };
            return colors[style] || colors['casual'];
        }
        
        function getHairColor(color) {
            const colors = {
                'black': 0x2d3748,
                'brown': 0x8b4513,
                'blonde': 0xf6e05e,
                'red': 0xc53030,
                'gray': 0x718096,
                'white': 0xf7fafc
            };
            return colors[color] || colors['brown'];
        }
        
        function getEyeColor(color) {
            const colors = {
                'brown': 0x8b4513,
                'blue': 0x3182ce,
                'green': 0x38a169,
                'hazel': 0xd69e2e,
                'gray': 0x718096
            };
            return colors[color] || colors['brown'];
        }
    </script>
</body>
</html>
